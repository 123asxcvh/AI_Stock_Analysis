#!/usr/bin/env python

"""
个股数据分析提示词定义
使用Python多行字符串，支持语法高亮和易于维护
"""

from datetime import datetime


def get_current_date() -> str:
    """获取当前日期字符串"""
    return datetime.now().strftime("%Y年%m月%d日")


def get_data_analysis_instruction() -> str:
    """获取数据分析指令"""
    current_date = get_current_date()
    return f"**重要说明：当前真实日期是{current_date}，请务必以此为准进行分析。严格基于提供的数据进行分析，不得质疑数据的准确性、完整性或来源可靠性。请按照最新的数据进行客观分析，不要进行主观推测。切记：现在是{current_date}，不是2022年或2024年！**"


# 公司概况分析 - 企业战略分析师
COMPANY_OVERVIEW = f"""# 任务：公司概况与投资价值分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

基于提供的公司概况和主营业务数据，分析公司的投资价值。

## 分析框架

### 1. 公司基本情况
- 公司名称、代码、行业分类
- 企业性质、成立背景、发展阶段
- 市场地位和影响力

### 2. 业务结构分析
- 主要业务收入占比和利润贡献
- 各业务盈利能力对比
- 业务转型趋势分析

### 3. 竞争优势评估
- 核心竞争优势识别
- 护城河类型和强度
- 可持续性评估

### 4. 业务未来前景判断
- 业务发展趋势评估
- 核心优势和潜在挑战
- 未来发展前景分析

**输出要求：**
- 基于数据客观分析，避免主观猜测
- 引用具体数据支撑结论
- 语言简洁专业"""


# 资产负债表分析 - 财务分析师
BALANCE_SHEET_ANALYSIS = f"""# 任务：资产负债表分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

**重要背景信息：**
在开始资产负债表分析之前，请先了解该公司的基本情况，包括公司名称、主营业务、行业地位等核心信息，这将有助于您更好地理解公司的资产结构和财务状况。

基于提供的资产负债表数据和公司背景信息，进行专门的资产负债表分析。

## 分析框架

### 1. 资产结构分析
- 总资产规模及变化趋势
- 资产构成分析（流动资产 vs 非流动资产）
- 核心资产项目评估（货币资金、应收账款、存货、固定资产等）

### 2. 负债结构分析
- 总负债规模及变化趋势
- 负债构成分析（流动负债 vs 非流动负债）
- 主要负债项目评估（短期借款、应付账款、长期借款等）

### 3. 所有者权益分析
- 股本规模及变化
- 资本结构分析（负债率、权益乘数）
- 留存收益变动情况

### 4. 财务稳定性评估
- 资产负债匹配度
- 偿债能力指标（流动比率、速动比率）
- 财务结构健康度评价

**输出要求：**
- 基于资产负债表数据客观分析
- 引用具体财务项目和比率
- 语言专业简洁"""

# 利润表分析 - 盈利能力分析师
INCOME_STATEMENT_ANALYSIS = f"""# 任务：利润表分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

**重要背景信息：**
在开始利润表分析之前，请先了解该公司的基本情况，包括公司名称、主营业务、行业地位等核心信息，这将有助于您更好地理解公司的收入结构和盈利模式。

基于提供的利润表数据和公司背景信息，进行专门的利润表分析。

## 分析框架

### 1. 收入结构分析
- 营业总收入规模及变化趋势
- 收入构成分析（主营业务收入 vs 其他收入）
- 收入季节性特征

### 2. 成本费用分析
- 营业成本分析及成本结构
- 期间费用分析（销售费用、管理费用、研发费用、财务费用）
- 费用率变化趋势

### 3. 盈利能力分析
- 毛利率分析及变化趋势
- 营业利润率分析
- 净利润率分析
- 盈利能力稳定性评估

### 4. 利润质量分析
- 利润构成质量（经营性利润占比）
- 利润增长质量（增长来源分析）
- 利润波动性分析

**输出要求：**
- 基于利润表数据客观分析
- 引用具体财务指标和比率
- 语言专业简洁"""

# 现金流量表分析 - 现金流分析师
CASH_FLOW_ANALYSIS = f"""# 任务：现金流量表分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

**重要背景信息：**
在开始现金流量表分析之前，请先了解该公司的基本情况，包括公司名称、主营业务、行业地位等核心信息，这将有助于您更好地理解公司的现金流转特点和投资融资策略。

基于提供的现金流量表数据和公司背景信息，进行专门的现金流量表分析。

## 分析框架

### 1. 现金流结构分析
- 经营活动现金流分析
- 投资活动现金流分析
- 筹资活动现金流分析
- 现金及现金等价物变动分析

### 2. 经营现金流分析
- 销售商品、提供劳务收到的现金
- 购买商品、接受劳务支付的现金
- 经营活动现金流质量分析

### 3. 投资现金流分析
- 投资支付的现金规模及用途
- 投资收回的现金情况
- 投资活动对现金流的影响

### 4. 现金流健康度评估
- 经营活动现金流充足性
- 自由现金流分析
- 现金流风险识别

**输出要求：**
- 基于现金流量表数据客观分析
- 引用具体现金流项目和指标
- 语言专业简洁"""

# 财务指标分析 - 财务指标分析师
FINANCIAL_INDICATORS_ANALYSIS = f"""# 任务：财务指标分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

**重要背景信息：**
在开始财务指标分析之前，请先了解该公司的基本情况，包括公司名称、主营业务、行业地位等核心信息，这将有助于您更好地理解公司的财务表现和行业特征。

基于提供的财务指标数据和公司背景信息，进行专门的财务指标分析。

## 分析框架

### 1. 盈利能力指标分析
- 净资产收益率（ROE）分析
- 毛利率、净利率分析
- 总资产收益率分析

### 2. 成长能力指标分析
- 营业收入增长率分析
- 净利润增长率分析
- 成长持续性评估

### 3. 偿债能力指标分析
- 资产负债率分析
- 流动比率、速动比率分析
- 偿债风险水平评估

### 4. 营运效率指标分析
- 应收账款周转率分析
- 存货周转率分析
- 总资产周转率分析

**输出要求：**
- 基于财务指标数据客观分析
- 引用具体财务指标数值
- 语言专业简洁"""

# 技术分析 - 综合技术分析师
TECHNICAL_ANALYSIS = f"""# 任务：技术分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

基于提供的技术指标数据，进行技术分析。

## 分析框架

### 1. 价格趋势分析
- 趋势方向识别
- 支撑阻力位分析
- 趋势强度评估

### 2. 技术指标分析
- MACD指标分析
- BBI多空指标分析
- KDJ随机指标分析
- 成交量分析

### 3. 技术信号识别
- 买卖信号识别
- 信号强度评估
- 技术风险分析

### 4. 操作策略建议
- 入场时机建议
- 出场时机建议
- 止损策略

**输出要求：**
- 基于技术指标客观分析
- 引用具体技术指标
- 语言专业简洁"""

# 日内交易分析 - 日内交易分析师
INTRADAY_TRADING_ANALYSIS = f"""# 任务：日内交易分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

基于提供的5分钟级别日内交易数据，进行日内交易分析。

## 分析框架

### 1. 日内价格走势分析
- 开盘表现分析
- 盘中波动特征
- 收盘表现评估

### 2. 成交量与流动性分析
- 成交量分布特征
- 量价关系分析
- 流动性风险评估

### 3. 技术指标分析
- 涨跌幅分析
- 振幅分析
- 换手率分析

### 4. 交易策略建议
- 交易信号识别
- 入场出场时机
- 风险控制措施

**输出要求：**
- 基于交易数据客观分析
- 引用具体交易指标
- 语言专业简洁"""


# 综合分析 - 投资决策总监 (Chief Investment Officer)
COMPREHENSIVE_ANALYSIS = f"""# 任务：综合投资决策分析

**分析股票代码：{{stock_code}}**
**分析日期：{get_current_date()}**

{get_data_analysis_instruction()}

**重要提醒：你现在是沃伦·巴菲特，拥有25年投资经验，你将综合所有专业团队提供的分析报告，做出最终投资决策。你必须严格遵循价值投资原则：能力圈、护城河、安全边际、财务稳健。**

## 数据分析优先级指导

**第一优先级：基本面数据（决定是否值得投资）**
1. **公司概况分析**：判断公司是否在你的能力圈内，了解商业模式和竞争地位
2. **财务四大报表分析**：评估财务健康度、盈利质量、现金流状况
   - 资产负债表分析（财务结构、偿债能力）
   - 利润表分析（盈利能力、收入质量）
   - 现金流量表分析（现金创造能力）
   - 财务指标分析（综合财务表现）

**第二优先级：技术面数据（决定投资时机）**
3. **技术分析**：识别趋势、支撑阻力位、超买超卖信号
4. **日内交易分析**：了解短期交易行为和市场情绪


## 综合分析框架

### 1. 公司质量评估（基本面第一）
- **商业模式质量**：是否是好生意？是否有持续竞争优势？
- **护城河分析**：公司是否拥有可持续的竞争优势？
- **财务健康度**：财务是否稳健？是否存在重大风险？
- **管理层能力**：管理层是否值得信赖？执行力如何？

### 2. 价值评估（安全边际检查）
- **内在价值估算**：基于基本面数据估算公司真实价值
- **安全边际分析**：当前价格是否提供足够的安全边际？
- **盈利能力预测**：未来盈利的可持续性和增长潜力

### 3. 技术面分析（时机选择）
- **市场先生情绪**：当前市场情绪是恐惧还是贪婪？
- **趋势状态**：股价处于什么趋势阶段？
- **技术信号**：是否存在重要的买入/卖出信号？

### 4. 风险收益权衡
- **下行风险**：最大可能损失是多少？
- **上行潜力**：合理的目标价位是多少？
- **概率判断**：投资成功的概率有多高？

### 5. 数据冲突处理原则
- **基本面 vs 技术面冲突**：基本面优先，技术面用于时机选择
- **短期 vs 长期冲突**：长期基本面更重要
- **数据质量冲突**：优先考虑财务报表数据

### 6. 最终投资决策
**明确的投资建议（选择其一）：**
- **积极买入**：基本面优秀，价格合理，技术面配合
- **逢低吸纳**：基本面优秀，价格偏高，等待回调
- **持有观望**：基本面一般，持有观望
- **逐步减仓**：基本面恶化，择机卖出
- **不予考虑**：基本面很差，完全排除

**必须包含的关键要素：**
- 投资建议和理由
- 目标价位区间（如果适用）
- 主要风险提示
- 持有期预期
- 止损条件

**输出要求：**
- 用巴菲特的投资哲学和语言风格
- 严格基于提供的数据，不做主观推测
- 语言简洁有力，逻辑清晰
- 重点突出，避免冗长描述"""

# 个股分析提示词映射字典
STOCK_PROMPTS = {
    "company_profile": {
        "stock_system_prompt": "corporate_strategist",
        "stock_user_prompt": COMPANY_OVERVIEW,
    },
    "balance_sheet_analysis": {
        "stock_system_prompt": "balance_sheet_analyst",
        "stock_user_prompt": BALANCE_SHEET_ANALYSIS,
    },
    "income_statement_analysis": {
        "stock_system_prompt": "income_statement_analyst",
        "stock_user_prompt": INCOME_STATEMENT_ANALYSIS,
    },
    "cash_flow_analysis": {
        "stock_system_prompt": "cash_flow_analyst",
        "stock_user_prompt": CASH_FLOW_ANALYSIS,
    },
    "financial_indicators_analysis": {
        "stock_system_prompt": "financial_indicators_analyst",
        "stock_user_prompt": FINANCIAL_INDICATORS_ANALYSIS,
    },
    "technical_analysis": {
        "stock_system_prompt": "technical_analyst",
        "stock_user_prompt": TECHNICAL_ANALYSIS,
    },
    "intraday_trading": {
        "stock_system_prompt": "intraday_trading_analyst",
        "stock_user_prompt": INTRADAY_TRADING_ANALYSIS,
    },
    "comprehensive_analysis": {
        "stock_system_prompt": "chief_investment_officer",
        "stock_user_prompt": COMPREHENSIVE_ANALYSIS,
    }
}